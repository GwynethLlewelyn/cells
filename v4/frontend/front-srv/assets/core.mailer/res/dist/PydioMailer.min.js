!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PydioMailer=e()}(function(){return function r(n,o,a){function i(t,e){if(!o[t]){if(!n[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(l)return l(t,!0);throw(s=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",s}s=o[t]={exports:{}},n[t][0].call(s.exports,function(e){return i(n[t][1][e]||e)},s,s.exports,r,n,o,a)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)i(a[e]);return i}({1:[function(e,t,s){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(s,"__esModule",{value:!0}),s.PreferencesPanel=s.Pane=void 0;var u=o(e("react")),r=o(e("prop-types")),a=o(e("pydio/http/api")),p=e("material-ui"),i=e("cells-sdk");function o(e){return e&&e.__esModule?e:{default:e}}function l(t,e){var s,r=Object.keys(t);return Object.getOwnPropertySymbols&&(s=Object.getOwnPropertySymbols(t),e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,s)),r}function c(r){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach(function(e){var t,s;t=r,e=n[s=e],s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})}return r}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,s){return t&&f(e.prototype,t),s&&f(e,s),e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(s){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=b(s);return e=r?(e=b(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),t=this,!(e=e)||"object"!==n(e)&&"function"!=typeof e?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v={chip:{marginRight:4,marginBottom:4},wrapper:{display:"flex",flexWrap:"wrap"},overlay:{position:"absolute",top:0,right:0,left:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.33)",paddingTop:77,zIndex:100}},j=function(){m(t,u["default"].Component);var e=y(t);function t(){return d(this,t),e.apply(this,arguments)}return h(t,[{key:"render",value:function(){var e=this.props.user;return u.default.createElement("div",{className:"share-dialog user-badge user-type-"+(e.getTemporary()?"tmp_user":"user")},u.default.createElement("span",{className:"avatar icon-"+(e.getTemporary()?"envelope":"user")}),u.default.createElement("span",{className:"user-badge-label"},e.getExtendedLabel()||e.getLabel()))}}]),t}(),O=function(){m(t,u["default"].Component);var e=y(t);function t(){return d(this,t),e.apply(this,arguments)}return h(t,[{key:"render",value:function(){var e=this.props,t=e.user,s=e.onRemove,r=t.FreeValue,n=r?t.FreeValue:t.Attributes&&t.Attributes.displayName?t.Attributes.displayName:t.Login,e=u.default.createElement(p.FontIcon,{className:"icon-"+(r?"envelope":"user")}),t=p.Style.colors;return u.default.createElement(p.Chip,{backgroundColor:r?t.lightBlue100:t.blueGrey100,onRequestDelete:function(){s()},style:v.chip},u.default.createElement(p.Avatar,{icon:e,color:r?"white":t.blueGrey600,backgroundColor:r?t.lightBlue300:t.blueGrey300}),n)}}]),t}(),P=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;d(this,r),this._subjects=[],this._messages=[],this._targets=[],this._links=[],this.templateId="",this.templateData={},e&&this._subjects.push(e),t&&this._messages.push(t),s&&this._links.push(s)}return h(r,[{key:"addTarget",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this._targets.push(e),t&&this._subjects.push(t),s&&this._messages.push(s),r&&this._links.push(r)}},{key:"setTemplateData",value:function(e,t){this.templateId=e,this.templateData=t}},{key:"postOne",value:function(e,t,s,r){var n=new i.MailerServiceApi(a.default.getRestClient()),o=new i.MailerMail;return o.Subject=t,o.To=e.map(function(e){return i.MailerUser.constructFromObject({Uuid:e})}),o.TemplateId=s,o.TemplateData=r,n.send(o)}},{key:"post",value:function(){var r=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(!this._subjects.length&&!this.templateId||!this._targets.length||!this._messages.length)throw new Error("Invalid data");var e,n=c({},this.templateData),o=[];1<this._messages.length&&this._messages.length===this._targets.length&&this._subjects.length===this._targets.length?this._targets.map(function(e,t){var s=r._subjects[t];n=c(c({},n),{},{Message:r._messages[t]}),o.push(r.postOne([e],s,r.templateId,n))}):(e=this._subjects[0],n.Message=this._messages[0],o.push(this.postOne(this._targets,e,this.templateId,n))),Promise.all(o).then(function(){t(!0)}).catch(function(e){e.response&&e.response.body&&e.response.body.Title&&(e=new Error(e.response.body.Title)),t(!1,e)})}}]),r}(),e=function(){m(s,u["default"].Component);var t=y(s);function s(e){return d(this,s),void 0===e.showAddressBook&&(e.showAddressBook=!0),(e=t.call(this,e)).state={users:e.props.users||{},subject:e.props.subject,message:e.props.message,errorMessage:null,posting:!1},e}return h(s,[{key:"updateSubject",value:function(e){this.setState({subject:e.currentTarget.value})}},{key:"updateMessage",value:function(e){this.setState({message:e.currentTarget.value})}},{key:"addUser",value:function(e){var t=this.state.users;e.FreeValue?t[e.FreeValue]=e:e.IdmUser&&(t[e.IdmUser.Login]=e.IdmUser),this.setState({users:t,errorMessage:null})}},{key:"removeUser",value:function(e){var t=this.state.users;delete t[e],this.setState({users:t})}},{key:"getMessage",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;try{return(e=void 0===e?"core.mailer":e)&&(e+="."),pydio.MessageHash[e+t]}catch(e){return t}}},{key:"postEmail",value:function(){var e,t,s,r,n=this,o=this.state,a=o.users,i=o.subject,l=o.message;if(!(0<arguments.length&&void 0!==arguments[0]&&arguments[0])&&this.refs.completer&&this.refs.completer.getPendingSearchText&&this.refs.completer.getPendingSearchText())return this.refs.completer.onCompleterRequest(this.refs.completer.getPendingSearchText(),-1),void setTimeout(function(){return n.postEmail(!0)},500);Object.keys(a).length?(e=(s=this.props).link,t=s.templateId,o=s.templateData,s=function(e,t){n.setState({posting:!1}),e?(n.props.pydio.UI.displayMessage("SUCCESS",n.props.pydio.MessageHash["core.mailer.1"].replace("%s",Object.keys(a).length)),n.props.onDismiss?n.props.onDismiss():n.setState({users:{},subject:"",message:""})):n.props.pydio.UI.displayMessage("ERROR",n.props.pydio.MessageHash["core.mailer.sender.error"]+(t?" : "+t.message:""))},this.setState({posting:!0}),this.props.processPost?this.props.processPost(P,a,i,l,e,s):(r=new P(i,l,e||null),Object.keys(a).forEach(function(e){r.addTarget(e)}),t&&r.setTemplateData(t,o),r.post(s))):this.setState({errorMessage:this.getMessage(2)})}},{key:"render",value:function(){var e,t=this,s=this.state,r=s.users,n=s.posting,o=s.errorMessage,a=s.subject,i=s.message,l=[this.props.className,"react-mailer","reset-pydio-forms"].join(" "),s=Object.keys(r).map(function(e){var t=this;return u.default.createElement(O,{key:e,user:r[e],onRemove:function(){t.removeUser(e)}})}.bind(this));o&&(e=u.default.createElement("div",{style:{padding:"10px 20px",color:"red"}},o));o=c({margin:this.props.uniqueUserStyle?0:8},this.props.style),n=u.default.createElement(p.Paper,{zDepth:void 0!==this.props.zDepth?this.props.zDepth:2,className:l,style:o},u.default.createElement("h3",{style:c({padding:20,color:"rgba(0,0,0,0.87)",fontSize:25,marginBottom:0,paddingBottom:10},this.props.titleStyle)},this.props.panelTitle),e,this.props.additionalPaneTop,!this.props.uniqueUserStyle&&u.default.createElement("div",{className:"users-block",style:c({padding:"0 20px"},this.props.usersBlockStyle)},u.default.createElement(PydioComponents.UsersCompleter,{ref:"completer",fieldLabel:this.getMessage("8"),usersOnly:!0,existingOnly:!0,freeValueAllowed:!0,onValueSelected:this.addUser.bind(this),excludes:Object.keys(r),renderSuggestion:function(e){return u.default.createElement(j,{user:e})},pydio:pydio,showAddressBook:this.props.showAddressBook,underlineHide:!0}),u.default.createElement("div",{style:v.wrapper},s)),!this.props.uniqueUserStyle&&u.default.createElement(p.Divider,null),!this.props.templateId&&u.default.createElement("div",{style:{padding:"0 20px"}},u.default.createElement(p.TextField,{fullWidth:!0,underlineShow:!1,floatingLabelText:this.getMessage("6"),value:a,onChange:this.updateSubject.bind(this)})),!this.props.templateId&&u.default.createElement(p.Divider,null),u.default.createElement("div",{style:c({padding:"0 20px"},this.props.messageBlockStyle)},u.default.createElement(p.TextField,{fullWidth:!0,underlineShow:!1,floatingLabelText:this.getMessage("7"),value:i,multiLine:!0,onChange:this.updateMessage.bind(this),rowsMax:6})),this.props.additionalPaneBottom,u.default.createElement(p.Divider,null),u.default.createElement("div",{style:{textAlign:"right",padding:"8px 20px"}},this.props.onDismiss&&u.default.createElement(p.FlatButton,{label:this.getMessage("54",""),onClick:this.props.onDismiss}),!this.props.onDismiss&&u.default.createElement(p.FlatButton,{label:this.getMessage("216",""),onClick:function(){t.setState({users:{},subject:"",message:""})}}),u.default.createElement(p.FlatButton,{disabled:n,primary:!0,label:this.getMessage("77",""),onClick:function(e){return t.postEmail()}})));return this.props.overlay?u.default.createElement("div",{style:v.overlay},n):n}}]),s}();(s.Pane=e).PropTypes={message:r.default.string,subject:r.default.string,templateId:r.default.string,templateData:r.default.object,link:r.default.string,onDismiss:r.default.func,className:r.default.string,overlay:r.default.bool,uniqueUserStyle:r.default.bool,users:r.default.object,panelTitle:r.default.string,zDepth:r.default.number,showAddressBook:r.default.bool,processPost:r.default.func,additionalPaneTop:r.default.instanceOf(u.default.Component),additionalPaneBottom:r.default.instanceOf(u.default.Component)},s.PreferencesPanel=function(){m(t,u["default"].Component);var e=y(t);function t(){return d(this,t),e.apply(this,arguments)}return h(t,[{key:"render",value:function(){return u.default.createElement("div",null,"Preferences Panel")}}]),t}()},{"cells-sdk":"cells-sdk","material-ui":"material-ui","prop-types":"prop-types","pydio/http/api":"pydio/http/api",react:"react"}],2:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"Pane",{enumerable:!0,get:function(){return r.Pane}}),Object.defineProperty(s,"PreferencesPanel",{enumerable:!0,get:function(){return r.PreferencesPanel}});var r=e("./components")},{"./components":1}]},{},[2])(2)});