!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).CompressionActions=e()}(function(){return function n(a,o,r){function s(t,e){if(!o[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(i=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",i}i=o[t]={exports:{}},a[t][0].call(i.exports,function(e){return s(a[t][1][e]||e)},i,i.exports,n,a,o,r)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<r.length;e++)s(r[e]);return s}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Callbacks=i.CompressionDialog=void 0;var n=c(e("pydio")),r=c(e("react")),a=c(e("create-react-class")),o=c(e("pydio/http/api")),s=e("cells-sdk"),l=c(e("pydio/util/path")),u=e("material-ui");function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var e=n.default.requireLib("hoc"),p=e.ModernTextField,f=e.ModernSelectField,n=n.default.requireLib("boot").ActionDialogMixin,n=(0,a.default)({displayName:"CompressionDialog",mixins:[n],getDefaultProps:function(){var e=["zip","tar","tar.gz"];return pydio.Parameters.get("multipleFilesDownloadEnabled")||e.pop(),{dialogTitleId:313,legendId:314,dialogIsModal:!0,formats:e}},getInitialState:function(){var e,t=this.props.userSelection;t.isUnique()?(e=l.default.getBasename(t.getUniqueFileName()),t.hasDir()||(e=e.substr(0,e.lastIndexOf(".")))):""===(e=l.default.getBasename(t.getContextNode().getPath()))&&(e="Archive");t=this.props.formats[0];return{archiveBase:e,compression:t,fileName:this.buildUniqueFileName(e,t),loading:!1}},getButtons:function(e){return this._updater=e,this.makeButtons()},makeButtons:function(){var e=this,t=this.state.loading;return[r.default.createElement(u.FlatButton,{key:"cancel",label:this.props.pydio.MessageHash[49],primary:!1,onClick:function(){return e.dismiss()}}),r.default.createElement(u.FlatButton,{label:this.props.pydio.MessageHash[48],primary:!0,keyboardFocused:!0,disabled:t,onClick:function(){return e.submit()}})]},buildUniqueFileName:function(e,t){for(var i=0,n=e,a=e;this.props.userSelection.fileNameExists(n+"."+t,!0);)0<i&&(n=a+"-"+i),i++;return n},textFieldChange:function(e,t){this.setState({archiveBase:t,fileName:this.buildUniqueFileName(t,this.state.compression)})},selectFieldChange:function(e,t,i){this.setState({compression:i,fileName:this.buildUniqueFileName(this.state.archiveBase,i)})},submit:function(){var t=this,e=this.props.userSelection.getFileNames(),i=this.props.pydio.user.getActiveRepositoryObject().getSlug(),n=(n=i+this.props.userSelection.getContextNode().getPath()+"/"+this.state.fileName+"."+this.state.compression).replace("//","/"),n=s.RestUserJobRequest.constructFromObject({JobName:"compress",JsonParameters:JSON.stringify({archiveName:n,format:this.state.compression,nodes:e.map(function(e){return i+e})})}),e=new s.JobsServiceApi(o.default.getRestClient());this.setState({loading:!0},function(){return t._updater(t.makeButtons())}),e.userCreateJob("compress",n).then(function(e){t.dismiss(),t.setState({loading:!1},function(){return t._updater(t.makeButtons())})}).catch(function(e){t.setState({loading:!1,err:e.message},function(){return t._updater(t.makeButtons())})})},render:function(){var e=this.props.formats.map(function(e){return r.default.createElement(u.MenuItem,{value:e,primaryText:"."+e})}),t=this.props.pydio.MessageHash,i=this.state,n=i.compression,a=i.fileName,o=i.err,i={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"};return r.default.createElement("div",null,r.default.createElement("div",{style:{display:"flex"}},r.default.createElement(p,{style:{width:210,marginRight:10},onChange:this.textFieldChange,value:a,floatingLabelText:t["compression.4"],floatingLabelStyle:i}),r.default.createElement(f,{style:{width:160},onChange:this.selectFieldChange,value:n,floatingLabelText:t["compression.3"],floatingLabelStyle:i},e)),o&&r.default.createElement("div",{style:{color:"#e53935"}},o))}});i.CompressionDialog=n,i.Callbacks=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,i,n;return t=e,n=[{key:"compressUI",value:function(e){var t=e.getPydio(),e=t.getUserSelection();t.Parameters.get("multipleFilesDownloadEnabled")&&t.UI.openComponentInModal("CompressionActions","CompressionDialog",{userSelection:e})}},{key:"extract",value:function(e){var t=e.getPydio(),i=t.getUserSelection();i.isEmpty()||(e=i.getUniqueFileName(),"gz"===(i=l.default.getFileExtension(e))&&(i="tar.gz"),t=t.user.getActiveRepositoryObject().getSlug(),i=s.RestUserJobRequest.constructFromObject({JobName:"extract",JsonParameters:JSON.stringify({node:t+e,format:i,target:""})}),new s.JobsServiceApi(o.default.getRestClient()).userCreateJob("extract",i))}}],(i=null)&&d(t.prototype,i),n&&d(t,n),e}()},{"cells-sdk":"cells-sdk","create-react-class":"create-react-class","material-ui":"material-ui",pydio:"pydio","pydio/http/api":"pydio/http/api","pydio/util/path":"pydio/util/path",react:"react"}]},{},[1])(1)});